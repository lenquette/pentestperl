#!/usr/bin/perl

print "Please chose one of the following: \n";
print "\t1. scan a network\n";
print "\t2. scan a host\n";
chomp($choice=<STDIN>);


# scanning a network 
if ($choice == 1) {
	print "Please Enter the network IP ex: 192.168.1.0/24\n";
	chomp($network_ip=<STDIN>);
	open ($input, "nmap -sP $network_ip |") || die "could not run nmap";
	open(HANDLE, ">pentest.txt") || die "could not open the file";

	print HANDLE " ------------ The machines detected are ---------------------\n";
	while (<$input>) {
		chomp($line=<$input>);
		if ($line=~/([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})/) {
			#push(@IPS, $1);
			$ip1=$1;
		}
		if ($line =~ m/Nmap scan report for ([^\s]+)/) {
			#push(@names, $1);
			$name1=$1;
		}
		$machines{"$ip1"} = "$name1";
		#print HANDLE "$line\n";
	}
}

#print HANDLE "================================================\n";
#print HANDLE "Number of machines detected: ", $#IPS+1, "\n";
#for $item (@IPS) {
#	print HANDLE $i++, " $item\n";
#}

#print HANDLE "naaaaaaaaaaaaaaaaaaaaames\n";
#for $item (@names) {
#	print HANDLE $i++, "$item\n";
#}

print HANDLE "==================== Network Scan Result =======================\n";

print HANDLE "IP address\t Machine name\n";
foreach $item (keys %machines) {
	print HANDLE "$item \t $machines{$item} \n";
}	

print "
 ================================================================
#	       	    Scan Finished				#
# 	Your result will be in a file: pentest.txt		#
 ===============================================================\n";


close $input;
close HANDLE;
